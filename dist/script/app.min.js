!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([function(t,e,s){},function(t,e,s){"use strict";s.r(e);s(0);class i{constructor(t,e,s){this._gameMgr=t,this._areaMgr=e,this._charaMgr=s}init(){this._gameMgr.init(),this._areaMgr.init()}start(){this._gameMgr.start()}stop(){this._gameMgr.stop()}reset(){this._gameMgr.reset()}getGameManager(){return this._gameMgr}getAreaManager(){return this._areaMgr}getCharaManager(){return this._charaMgr}getSpace(){return this._areaMgr.getSpace()}getField(){return this._areaMgr.getField()}getPlayer(){return this._charaMgr.getPlayer()}getCharacterList(){return this._charaMgr.getCharacterList()}getScore(){return this._gameMgr.getScore()}isPlaying(){return this._gameMgr.isPlaying()}isGameClear(){return this._gameMgr.isGameClear()}isGameOver(){return this._gameMgr.isGameOver()}update(){this._gameMgr.update()}resize(){this._areaMgr.resize()}}class r{constructor(t,e,s,i,r){this._charaMgr=t,this._ruleMgr=e,this._scoreMgr=s,this._timeMgr=i,this._stateMgr=r}isPlaying(){return this._stateMgr.getState()}isGameClear(){return this.getScore()>99}isGameOver(){return this.getScore()<0}getScore(){return this._scoreMgr.score}init(){}start(){this._stateMgr.start(),this._charaMgr.addPlayer()}stop(){this._stateMgr.stop()}update(){this.createEnemy(),this._charaMgr.update(),this._ruleMgr.update(),this.cleanUp()}createEnemy(){return this.getScore()>9?this.addBoss():!0===this._timeMgr.isAppearTime()?this.addEnemy():void 0}addEnemy(){this._charaMgr.addEnemy()}addBoss(){this._charaMgr.addBoss()}cleanUp(){let t=0;const e=this._charaMgr.getDisposeTaget();for(const s of e)t+=s.getScore();this._scoreMgr.changeScore(t),this._charaMgr.disposeCharacter()}}class n{constructor(t,e){this.mCrashMgr=t,this.mFieldMgr=e}update(){this.mCrashMgr.update(),this.mFieldMgr.update()}}class o{constructor(t,e){this._space=t,this._field=e}getSpace(){return this._space}getField(){return this._field}init(){this._space.init(),this._field.init()}resize(){this._space.resize(),this._field.resize()}}class h{constructor(t,e){this._list=t,this._factory=e,this._player=null,this._boss=null}getCharacterList(){return this._list.toArray()}getPlayer(){return this._player}getBoss(){return this._boss}addPlayer(){if(null!==this._player)return;const t=this._factory.createPlayer(this);this._player=t,this._list.addItem(t)}addBullet(){const t=this._factory.createBullet(this._player);this._list.addItem(t)}addEnemy(){const t=this._factory.createEnemy();this._list.addItem(t)}addBoss(){if(null!==this._boss)return;const t=this._factory.createBoss();this._boss=t,this._list.addItem(t)}getDisposeTaget(){return this._list.toArray().filter(t=>!0===t.getIsDispose())}removeCharacter(t){this._list.removeItem(t)}update(){for(const t of this._list)t.update()}disposeCharacter(){const t=this._list.toArray();for(let e of t)!1!==e.getIsDispose()&&(this.removeCharacter(e),e.dispose(),e=null)}}class a{constructor(){this._state=!1}getState(){return this._state}start(){this._state=!0}stop(){this._state=!1}}class c{constructor(){this._score=0}changeScore(t){this._score+=t}get score(){return this._score}}const l={root:"js-index",button:{start:"js-start-btn",stop:"js-stop-btn",reset:"js-reset-btn"},message:{win:"js-gameclear",lose:"js-gameover"},canvas:{space:"js-space",field:"js-field"}},g={default:"Index",playing:"-playing",win:"-win",lose:"-lose"},d={type:{load:"load",resize:"resize",start:"start",stop:"stop",reset:"reset",left:"left",right:"right",shoot:"shoot",none:"none"},swipe:{dist:50}},u={width:250,top:0},p={type:"player",width:50,height:50,life:1,score:-100,dist:50,grace:200,look:{normal:"./img/player.svg",dead:"./img/explosion.svg"},top:.9},_={type:"bullet",width:5,height:10,life:1,score:0,dist:-5,grace:0,look:{normal:"./img/bullet.svg"}},m={type:"enemy",width:50,height:50,life:1,score:1,dist:.5,grace:200,look:{normal:"./img/enemy.svg",dead:"./img/explosion.svg"},top:.1,interval:3e3},y={type:"boss",width:250,height:250,life:100,score:100,dist:.5,grace:200,look:{normal:"./img/boss.svg",dead:"./img/explosion.svg"}};class f{static getRandomInt(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}static getSpaceProp(){return{w:window.innerWidth,h:window.innerHeight,x:0,y:0}}static getFieldProp(){const t=u.width;return{w:t,h:window.innerHeight,x:window.innerWidth/2-t/2,y:0}}static getRootDom(){return document.getElementById(l.root)}static getConfigCssClass(){return g}static getConfigPlayer(){return p}static getConfigBullet(){return _}static getConfigEnemy(){return m}static getConfigBoss(){return y}static getConfigPlayerType(){return p.type}static getConfigBossType(){return y.type}static getConfigEventType(){return d.type}static getConfigSwipeDist(){return d.swipe.dist}}class w{constructor(){this.preAppearTime=Date.now()}isAppearTime(){const t=Date.now(),e=f.getConfigEnemy();return!(t-this.preAppearTime<e.interval)&&(this.preAppearTime=t,!0)}}class v{constructor(){this._index=0,this._list=new Array}addItem(t){this._list.push(t)}removeItem(t){this._list=this._list.filter(e=>e!==t)}getItem(){return this._list[this._index]}getCurrentIndex(){return this._index}getFirstIndex(){return 0}getLastIndex(){return this._list.length}hasNext(){return this._index!==this.getLastIndex()}hasPrev(){return this._index!==this.getFirstIndex()}*[Symbol.iterator](){for(;!0===this.hasNext();){const t=this.next();yield t.value}this._index=0}next(){const t=this.getItem();return this._index++,{done:!1,value:t}}prev(){this.hasPrev()&&this._index--}first(){this._index=this.getFirstIndex()}last(){this._index=this.getLastIndex()-1}toArray(){return this._list}}class x{constructor(t){this._charaMgr=t}crash(t){t.forEach(t=>t.hit())}update(){const t=this._charaMgr.getCharacterList().filter(t=>this.isCrash(t));this.crash(t)}isCrash(t){const e=t,s=this.getObjectPositionOfCenter(e),i=this.getObjectSizeFromCenter(e);let r=!1;const n=this._charaMgr.getCharacterList();let o,h,a,c;for(let t of n)if(e!==t&&(o=this.getObjectPositionOfCenter(t),h=this.getObjectSizeFromCenter(t),a=Math.abs(s.x-o.x)<i.w+h.w,c=Math.abs(s.y-o.y)<i.h+h.h,r=!0===a&&!0===c,!0===r))break;return r}getObjectPositionOfCenter(t){return{x:t.getLeft()+t.getWidth()/2,y:t.getTop()+t.getHeight()/2}}getObjectSizeFromCenter(t){return{w:t.getWidth()/2,h:t.getHeight()/2}}}class M{constructor(t){this._charaMgr=t}update(){const t=this._charaMgr.getCharacterList().filter(t=>this.isFieldOut(t));this.fieldOut(t)}isFieldOut(t){if(t.getType()===f.getConfigPlayerType())return!1;if(t.getType()===f.getConfigBossType())return!1;const e=f.getFieldProp(),s=t.getTop(),i=s+t.getHeight(),r=s<e.y,n=i>e.y+e.h;return!0===r||!0===n}fieldOut(t){t.forEach(t=>t.makeDisposeTarget())}}class C{constructor(t,e){this._width=t,this._height=e}set width(t){this._width=t}get width(){return this._width}set height(t){this._height=t}get height(){return this._height}}class b{constructor(t,e){this._x=t,this._y=e}set x(t){this._x=t}get x(){return this._x}set y(t){this._y=t}get y(){return this._y}moveX(t){this._x=this._x+t}moveY(t){this._y=this._y+t}}class E{constructor(t,...e){this._list=t,e.forEach(t=>this.addImage(t))}addImage(t){const e=new Image;e.src=t,e.onload=this._list.addItem(e)}getItem(){return this._list.getItem()}last(){this._list.last()}}class S{constructor(t,e,s,i,r){this._type=t,this._life=e,this._dist=s,this._score=i,this._grace=r}get type(){return this._type}get life(){return this._life}get dist(){return this._dist}get score(){return this._score}get grace(){return this._grace}hit(){this._life--}}class L{constructor(t,e){this.size=t,this.position=e}setWidth(t){this.size.width=t}getWidth(){return this.size.width}setHeight(t){this.size.height=t}getHeight(){return this.size.height}setLeft(t){this.position.x=t}getLeft(){return this.position.x}setTop(t){this.position.y=t}getTop(){return this.position.y}move(t,e){this.position.moveX(t),this.position.moveY(e)}update(){throw new Error}}class T extends L{constructor(t,e){super(t,e)}init(){const t=f.getSpaceProp();this.setWidth(t.w),this.setHeight(t.h)}resize(){this.init()}}class P extends L{constructor(t,e){super(t,e)}init(){const t=f.getFieldProp();this.setLeft(t.x),this.setTop(t.y),this.setWidth(t.w),this.setHeight(t.h)}resize(){this.init()}}class B extends L{constructor(t,e,s,i){super(t,e),this._look=s,this._status=i,this._isDispose=!1}getLook(){return this._look.getItem()}getType(){return this._status.type}getDist(){return this._status.dist}getScore(){return this._status.score}getGrace(){return this._status.grace}isDead(){return this._status.life<=0}getIsDispose(){return this._isDispose}update(){throw new Error}hit(){this._status.hit(),this.isDead()&&this.dead()}dead(){this._look.last();const t=this.getGrace();setTimeout(this.makeDisposeTarget.bind(this),t)}makeDisposeTarget(){this._isDispose=!0}dispose(){const t=this.getScore();return this._position=null,this._size=null,this._look=null,this._status=null,this._field=null,t}}class F extends B{constructor(t,e,s,i,r){super(t,e,s,i),this._mgr=r}update(){}shoot(){this._mgr.addBullet(this)}moveLeft(){const t=-1*this.getDist();this.position.moveX(t)}moveRight(){const t=this.getDist();this.position.moveX(t)}}class I extends B{constructor(t,e,s,i){super(t,e,s,i)}update(){this.move()}move(){const t=this.getDist();this.position.moveY(t)}}class z{createModelManager(t,e,s){return new i(t,e,s)}createGameMgr(t,e){const s=new c,i=new w,n=new a;return new r(t,e,s,i,n)}createRuleMgr(t,e){return new n(t,e)}createAreaMgr(){const t=this.createSpace(),e=this.createField();return new o(t,e)}createCharaMgr(){const t=new v;return new h(t,this)}createCrash(t){return new x(t)}createFieldOut(t){return new M(t)}createSpace(){const t=f.getSpaceProp(),e=new C(t.w,t.h),s=new b(t.x,t.y);return new T(e,s)}createField(){const t=f.getFieldProp(),e=new C(t.w,t.h),s=new b(t.x,t.y);return new P(e,s)}createPlayer(t){const e=f.getConfigPlayer(),s=f.getFieldProp(),i=e.width,r=e.height,n=new C(i,r),o=s.w/2-i/2,h=s.h*e.top-r,a=new b(o,h),c=new v,l=e.look.normal,g=e.look.dead,d=new E(c,l,g),u=e.type,p=e.life,_=e.score,m=e.dist,y=e.grace,w=new S(u,p,m,_,y);return new F(n,a,d,w,t)}createBullet(t){if(!t)return;const e=f.getConfigBullet(),s=e.width,i=e.height,r=new C(s,i),n=t.getLeft(),o=t.getTop(),h=t.getWidth(),a=new b(n+h/2-s/2,o-2*i),c=new v,l=e.look.normal,g=new E(c,l),d=e.type,u=e.life,p=e.score,_=e.dist,m=e.grace,y=new S(d,u,_,p,m);return new I(r,a,g,y)}createEnemy(){const t=f.getFieldProp(),e=f.getConfigEnemy(),s=e.width,i=e.height,r=new C(s,i),n=t.w/e.width,o=f.getRandomInt(0,n)*e.width,h=t.h*e.top,a=new b(o,h),c=new v,l=e.look.normal,g=e.look.dead,d=new E(c,l,g),u=e.type,p=e.life,_=e.score,m=e.dist,y=e.grace,w=new S(u,p,m,_,y);return new I(r,a,d,w)}createBoss(){const t=f.getConfigBoss(),e=f.getFieldProp(),s=t.width,i=t.height,r=new C(s,i),n=e.w/2-s/2,o=e.y-i,h=new b(n,o),a=new v,c=t.look.normal,l=t.look.dead,g=new E(a,c,l),d=t.type,u=t.life,p=t.score,_=t.dist,m=t.grace,y=new S(d,u,_,p,m);return new I(r,h,g,y)}}class D{constructor(t,e){this.space=t,this.field=e}getSpace(){return this.space}getField(){return this.field}init(){this.space.init(),this.field.init()}resize(){this.space.resize(),this.field.resize()}update(t){this.field.update(t)}}class k{constructor(){this._canvas=null,this._context=null}init(){this.style(),this.draw()}resize(){this.init()}style(){this.size(),this.position()}size(){new Error}position(){new Error}}class O extends k{constructor(t){super(),this._model=t,this._canvas=document.querySelector("#js-space"),this._context=this._canvas.getContext("2d")}size(){const t=this._model.getSpace(),e=t.getWidth(),s=t.getHeight();this._canvas.setAttribute("width",""+e),this._canvas.setAttribute("height",""+s)}position(){const t=this._model.getSpace(),e=t.getTop(),s=t.getLeft();this._canvas.style.position="absolute",this._canvas.style.top=e+"px",this._canvas.style.left=s+"px"}draw(){const t=this._model.getSpace(),e=t.getWidth(),s=t.getHeight(),i=this._context;i.fillStyle="#425A69",i.fillRect(0,0,e,s),i.fillStyle="#FFFFFF";for(let t=0;t<1e3;t++){let t=f.getRandomInt(0,e),r=f.getRandomInt(0,s);i.fillRect(t,r,1,1)}}}class j extends k{constructor(t){super(),this._model=t,this._canvas=document.querySelector("#js-field"),this._context=this._canvas.getContext("2d")}size(){const t=this._model.getField(),e=t.getWidth(),s=t.getHeight();this._canvas.setAttribute("width",""+e),this._canvas.setAttribute("height",""+s)}position(){const t=this._model.getField(),e=t.getTop(),s=t.getLeft();this._canvas.style.position="absolute",this._canvas.style.top=e+"px",this._canvas.style.left=s+"px"}draw(){const t=this._model.getCharacterList();let e=null,s=null,i=null,r=null,n=null;for(let o of t)e=o.getLook(),s=o.getLeft(),i=o.getTop(),r=o.getWidth(),n=o.getHeight(),this._context.drawImage(e,s,i,r,n)}erase(){const t=this._model.getField(),e=t.getWidth(),s=t.getHeight();this._context.clearRect(0,0,e,s)}update(){this.erase(),this.draw()}}class A{createManager(t,e){return new D(t,e)}createSpace(t){return new O(t)}createField(t,e){return new j(t,e)}}class R{init(){throw new Error("abstract method is called")}run(t){throw new Error("abstract method is called")}}class W extends R{constructor(t,e){super(),this._model=t,this._view=e}init(){}resize(){this._model.resize(),this._view.resize()}run(t){const e=f.getConfigEventType();return t.type===e.load?this.init():t.type===e.resize?this.resize():void 0}}class G extends R{constructor(t){super(),this._model=t}init(){}run(t){const e=f.getConfigEventType();return t.type===e.left?this.moveLeft():t.type===e.right?this.moveRight():t.type===e.shoot?this.shoot():void 0}moveLeft(){const t=this._model.getPlayer();t.getLeft()<=0||t.moveLeft()}moveRight(){const t=this._model.getField(),e=this._model.getPlayer(),s=t.getWidth()-e.getWidth();e.getLeft()>=s||e.moveRight()}shoot(){this._model.getPlayer().shoot()}}class H extends R{constructor(t,e){super(),this._model=t,this._view=e,this._requestID=null}init(){}run(t){const e=f.getConfigEventType();return t.type===e.start?this.start():t.type===e.stop?this.stop():t.type===e.reset?this.reset():void 0}start(){this._model.start(),this.controlDom(),this.update()}stop(){this._model.stop(),this.controlDom(),cancelAnimationFrame(this._requestID)}reset(){location.reload()}update(){return!0===this._model.isGameOver()||!0===this._model.isGameClear()?this.stop():(this._model.update(),this._view.update(),void(this._requestID=requestAnimationFrame(this.update.bind(this))))}controlDom(){const t=f.getConfigCssClass(),e=f.getRootDom();e.classList=t.default;if(!0===this._model.isPlaying())return e.classList.add(t.playing);const s=this._model.getScore();return s<0?e.classList.add(t.lose):s>99?e.classList.add(t.win):void 0}}class X{constructor(t,e,s){this._pcon=t,this._acon=e,this._gcon=s}init(){this._pcon.init(),this._acon.init(),this._gcon.init()}get playerController(){this._pcon}get areaController(){this._acon}get gameController(){this._gcon}}class q{createAreaController(t,e){return new W(t,e)}createPlayerController(t,e){return new G(t,e)}createGameController(t,e){return new H(t,e)}createControllerManager(t,e,s){return new X(t,e,s)}}class K{constructor(...t){this._itemList=t}init(){this._itemList.forEach(t=>t.init())}}class Y extends class{constructor(...t){this._observers=t}addObserver(t){this._observers.push(t)}deleteObserver(t){this._observers=this._observers.filter(e=>e!==t)}notify(){this._observers.forEach(t=>t.run(this))}}{constructor(...t){super(...t),this._type=""}get type(){return this._type}}class N extends Y{constructor(...t){super(...t)}init(){window.addEventListener("load",this.load.bind(this)),window.addEventListener("resize",this.resize.bind(this))}load(){const t=f.getConfigEventType();this._type=t.load,this.notify(this)}resize(){const t=f.getConfigEventType();this._type=t.resize,this.notify(this)}}class U extends Y{constructor(...t){super(...t),this.domStrBtn=document.querySelector("#js-start-btn"),this.domStpBtn=document.querySelector("#js-stop-btn"),this.domRstBtn=document.querySelector("#js-reset-btn")}init(){this.domStrBtn.addEventListener("click",this.pressButton.bind(this)),this.domStpBtn.addEventListener("click",this.pressButton.bind(this)),this.domRstBtn.addEventListener("click",this.pressButton.bind(this)),this.domStrBtn.addEventListener("touchstart",this.pressButton.bind(this)),this.domStpBtn.addEventListener("touchstart",this.pressButton.bind(this)),this.domRstBtn.addEventListener("touchstart",this.pressButton.bind(this))}pressButton(t){t.target===this.domStrBtn&&this.start(),t.target===this.domStpBtn&&this.stop(),t.target===this.domRstBtn&&this.reset(),this.notify(this)}start(){const t=f.getConfigEventType();this._type=t.start}stop(){const t=f.getConfigEventType();this._type=t.stop}reset(){const t=f.getConfigEventType();this._type=t.reset}}class J extends Y{constructor(...t){super(...t),this._disable=!1}init(){window.addEventListener("keydown",this.keydown.bind(this),!1),window.addEventListener("keyup",this.keyup.bind(this),!1)}keydown(t){if(!0===this._disable)return;this._disable=!0;const e=this.convertKeyCodeToMeaningStr(t.keyCode),s=f.getConfigEventType();null===e&&(this._type=s.none),e===s.shoot&&(this._type=s.shoot),e===s.left&&(this._type=s.left),e===s.right&&(this._type=s.right),this.notify()}convertKeyCodeToMeaningStr(t){const e=f.getConfigEventType();return 32===t?e.shoot:37===t?e.left:39===t?e.right:null}keyup(){this._disable=!1}}class Q extends Y{constructor(...t){super(...t),this._x1=0,this._x2=0}init(){window.addEventListener("touchstart",this.touchStart.bind(this),{passive:!1}),window.addEventListener("touchmove",this.touchMove.bind(this),{passive:!1}),window.addEventListener("touchend",this.touchEnd.bind(this),!1)}touchStart(t){t.preventDefault(),this._x1=t.touches[0].pageX,this._x2=t.touches[0].pageX}touchMove(t){t.preventDefault(),this._x2=t.changedTouches[0].pageX}touchEnd(){return this._x1>this._x2?this.moveLeft():this._x1<this._x2?this.moveRight():void 0}moveLeft(){if(this._x1-this._x2<f.getConfigSwipeDist())return;const t=f.getConfigEventType();this._type=t.left,this.notify()}moveRight(){if(this._x2-this._x1<f.getConfigSwipeDist())return;const t=f.getConfigEventType();this._type=t.right,this.notify()}}class V extends Y{constructor(...t){super(...t),this._x1=0,this._x2=0}init(){window.addEventListener("touchstart",this.touchStart.bind(this),{passive:!1}),window.addEventListener("touchmove",this.touchMove.bind(this),{passive:!1}),window.addEventListener("touchend",this.touchEnd.bind(this),{passive:!1})}touchStart(t){t.preventDefault(),this._x1=t.touches[0].pageX,this._x2=t.touches[0].pageX}touchMove(t){t.preventDefault(),this._x2=t.changedTouches[0].pageX}touchEnd(){Math.abs(this._x2-this._x1)>=f.getConfigSwipeDist()||this.shoot()}shoot(){const t=f.getConfigEventType();this._type=t.shoot,this.notify()}}class Z{createEventManager(...t){return new K(...t)}createWindowEvent(...t){return new N(...t)}createButtonEvent(...t){return new U(...t)}createKeydownEvent(...t){return new J(...t)}createSwipeEvent(...t){return new Q(...t)}createTouchEvent(...t){return new V(...t)}}!function(){const t=new z,e=t.createCharaMgr(),s=t.createAreaMgr(),i=t.createCrash(e),r=t.createFieldOut(e),n=t.createRuleMgr(i,r),o=t.createGameMgr(e,n),h=t.createModelManager(o,s,e),a=new A,c=a.createSpace(h),l=a.createField(h),g=a.createManager(c,l),d=new q,u=d.createPlayerController(h),p=d.createAreaController(h,g),_=d.createGameController(h,g),m=d.createControllerManager(u,p,_),y=new Z,f=y.createKeydownEvent(u),w=y.createSwipeEvent(u),v=y.createTouchEvent(u),x=y.createButtonEvent(_),M=y.createWindowEvent(p),C=y.createEventManager(f,w,v,x,M);h.init(),g.init(),m.init(),C.init()}()}]);